<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JH-Toolkit: include/jh/synchronous/ipc/shared_process_mutex.h File Reference</title>
<link rel="icon" href="Jindallae.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Oree.svg"/></td>
  <td id="projectalign">
   <div id="projectname">JH-Toolkit<span id="projectnumber">&#160;v1.4.0</span>
   </div>
   <div id="projectbrief">An engineering-oriented C++20 toolkit with duck-typed concepts, static design, async coroutines, and semantic containers — header-only, RTTI-free, and concurrency-friendly.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('shared__process__mutex_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">shared_process_mutex.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Cross-process shared (read/write) timed mutex built from process primitives.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="">jh/metax/t_str.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/synchronous/ipc/process_mutex.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/synchronous/ipc/process_counter.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/synchronous/ipc/process_cond_var.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/synchronous/ipc/ipc_limits.h</a>&quot;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &lt;stdexcept&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:jh_3A_3Async_3A_3Aipc_3A_3Ashared_5Fprocess_5Fmutex_3C_20S_2C_20HighPriv_20_3E" id="r_jh_3A_3Async_3A_3Aipc_3A_3Ashared_5Fprocess_5Fmutex_3C_20S_2C_20HighPriv_20_3E"><td class="memItemLeft">class &#160;</td><td class="memItemRight"><a class="el" href="classjh_1_1sync_1_1ipc_1_1shared__process__mutex.html">jh::sync::ipc::shared_process_mutex&lt; S, HighPriv &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cross-process shared/exclusive timed mutex with optional upgrade support.  <a href="classjh_1_1sync_1_1ipc_1_1shared__process__mutex.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adfb0f16884484057f10e5c2cd869c0a0" id="r_adfb0f16884484057f10e5c2cd869c0a0"><td class="memTemplParams" colspan="2"><a id="adfb0f16884484057f10e5c2cd869c0a0" name="adfb0f16884484057f10e5c2cd869c0a0"></a>
template&lt;jh::meta::TStr S, bool HighPriv&gt; </td></tr>
<tr class="memitem:adfb0f16884484057f10e5c2cd869c0a0 template"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><b>jh::sync::ipc::shared_process_mutex&lt; S, HighPriv &gt;::has_shared_lock_</b> = false</td></tr>
<tr class="memitem:a3f61f45aa10e1611890ce58805254e20" id="r_a3f61f45aa10e1611890ce58805254e20"><td class="memTemplParams" colspan="2"><a id="a3f61f45aa10e1611890ce58805254e20" name="a3f61f45aa10e1611890ce58805254e20"></a>
template&lt;jh::meta::TStr S, bool HighPriv&gt; </td></tr>
<tr class="memitem:a3f61f45aa10e1611890ce58805254e20 template"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><b>jh::sync::ipc::shared_process_mutex&lt; S, HighPriv &gt;::has_exclusive_lock_</b> = false</td></tr>
<tr class="memitem:a2c8229eabe879f4b590c80c9a66070a9" id="r_a2c8229eabe879f4b590c80c9a66070a9"><td class="memTemplParams" colspan="2"><a id="a2c8229eabe879f4b590c80c9a66070a9" name="a2c8229eabe879f4b590c80c9a66070a9"></a>
template&lt;jh::meta::TStr S, bool HighPriv&gt; </td></tr>
<tr class="memitem:a2c8229eabe879f4b590c80c9a66070a9 template"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><b>jh::sync::ipc::shared_process_mutex&lt; S, HighPriv &gt;::has_prior_lock_</b> = false</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Cross-process shared (read/write) timed mutex built from process primitives. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2025 JeongHan-Bae &lt;mastropseudo@gmail.com&gt; <br  />
 Licensed under the Apache License, Version 2.0 (the "License"); <br  />
 you may not use this file except in compliance with the License.<br  />
 You may obtain a copy of the License at<br  />
 <br  />
 <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a><br  />
 <br  />
 Unless required by applicable law or agreed to in writing, software<br  />
 distributed under the License is distributed on an "AS IS" BASIS,<br  />
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br  />
 See the License for the specific language governing permissions and<br  />
 limitations under the License.<br  />
 <br  />
 Full license: <a href="https://github.com/JeongHan-Bae/JH-Toolkit?tab=Apache-2.0-1-ov-file#readme">GitHub</a></dd></dl>
<h3>Overview</h3>
<p><code><a class="el" href="classjh_1_1sync_1_1ipc_1_1shared__process__mutex.html" title="Cross-process shared/exclusive timed mutex with optional upgrade support.">jh::sync::ipc::shared_process_mutex</a></code> is a fully process-visible synchronization primitive providing both shared and exclusive locking semantics, similar to <code>std::shared_timed_mutex</code>, but implemented entirely from process-named OS primitives. It enables multiple participants — threads, coroutines, or processes — to coordinate access to a shared resource without requiring shared memory. </p>
<h3>Component composition</h3>
<ul>
<li>
<code>process_mutex&lt;S + ".exc"&gt;</code> — exclusive access control, preventing new readers during write phases. </li>
<li>
<code>process_cond_var&lt;S + ".cond"&gt;</code> — global condition variable used to wake writers or upgraders when readers exit. </li>
<li>
<code>process_counter&lt;S + ".cnt"&gt;</code> — global atomic counter tracking the number of active readers system-wide. </li>
<li>
<code>process_mutex&lt;S + ".pri"&gt;</code> — preemption mutex used exclusively by <b>upgraders</b>. It allows a participant upgrading from shared to exclusive mode to <b>preempt all waiting writers</b> and maintain <b>upgrade continuity</b>. Once <code>.pri</code> is held, no other process may enter exclusive mode until the upgrade completes. This lock does not enforce fairness — it ensures transactional upgrade atomicity. </li>
</ul>
<h3>Dependency</h3>
<p>The implementation is composed of three fundamental process-level synchronization primitives: </p><ul>
<li>
<code>#include "jh/synchronous/process_mutex.h"</code> — built upon <b>named semaphore</b>. </li>
<li>
<code>#include "jh/synchronous/process_counter.h"</code> — built upon <b>shared memory</b>. </li>
<li>
<code>#include "jh/synchronous/process_cond_var.h"</code> — built upon <b>shared memory</b>. </li>
</ul>
<h3>Platform compatibility</h3>
<p>On POSIX-compliant systems, all primitives are implemented using <b>native named IPC mechanisms</b> (POSIX semaphores and shared memory segments) and require no special privilege. </p>
<p>On <b>Windows</b>, due to the discrepancy between POSIX and Win32 IPC naming and visibility rules: </p><ul>
<li>
<b>Semaphores</b> must be created under the <code>Local\</code> namespace to be visible within the same session (used by <code>process_mutex</code>). </li>
<li>
<b>Shared memory objects</b> (<code>process_counter</code> and <code>process_cond_var</code>) must be created under the <code>Global\</code> namespace to allow inter-process linkage. </li>
</ul>
<h4>Important note (Windows privilege requirement)</h4>
<p>Because access to <code>Global\</code> objects requires administrative rights on Windows, both <code>process_counter</code> and <code>process_cond_var</code> must be initialized under elevated privilege. Consequently, any component that depends on them — including <code>shared_process_mutex</code> — must be executed as an <b>Administrator</b>. </p>
<p>This restriction does <b>not</b> apply to POSIX systems. </p>
<h4>Testing and validation</h4>
<p>On Windows, we built the library under the <b>URT64</b> toolchain and verified execution in the <b>native PowerShell environment</b>. The IPC primitives were confirmed to function correctly across processes in the same session. </p>
<p>Note that <b>MSYS2 (URT64)</b> environments typically run under <em>root-equivalent privilege</em>, meaning CI environments may fail to detect privilege-related issues. </p>
<p>As of the current implementation: </p><ul>
<li>
<code>process_mutex</code> (semaphore-based) — operates correctly under <b>normal privilege</b>. </li>
<li>
<code>process_counter</code> and <code>process_cond_var</code> (shared-memory-based) — require <b>administrator privilege</b> for creation and access. </li>
</ul>
<p>Consequently, <code>shared_process_mutex</code> on Windows functions correctly only when executed under administrative rights. </p>
<h4>Design stance</h4>
<p>In the <b>jh-toolkit IPC model</b>, Windows is treated as a <b>second-class citizen</b>: parity of semantics with POSIX is ensured, but the privilege requirement remains unavoidable. Therefore, when using <code>shared_process_mutex</code> for inter-process read/write coordination on Windows, administrative rights are mandatory. </p>
<h3>Design guarantees</h3>
<ul>
<li>
<b>Global visibility</b>: all cooperating processes and threads share the same OS-named primitives. </li>
<li>
<b>Compile-time fixed identity</b>: the template parameter <code>TStr S</code> uniquely defines the synchronization group. </li>
<li>
<b>Exclusive upgrade continuity</b>: once an upgrade begins, it completes without interference from writers. </li>
<li>
<b>Deterministic semantics</b>: fairness is not guaranteed; consistency and isolation are prioritized. </li>
</ul>
<h4>Upgrade semantics</h4>
<p>The upgrade operation may be initiated by <b>any participant</b> holding a shared lock — including threads, coroutines, or separate processes bound to the same named primitives. Because upgrade must occur in a <b>continuous global scope</b>, the upgrader cannot yield to a waiting writer without breaking its semantic integrity. </p>
<p>Therefore, if <code>.exc</code> cannot be immediately acquired, the upgrader seizes <code>.pri</code> to <b>preempt all writers</b> that were already waiting. Once <code>.pri</code> is held, the upgrader waits for all other readers to exit and then transitions into exclusive mode. Any concurrent upgrader attempting the same will be treated as a global protocol violation and cause forced unlink and termination. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
</div> <!-- top -->
<hr class="footer"/>
<div class="footer">
    <img class="footer-logo" src="Ojing.svg" alt="Ojing"/>
    <div class="footer-text">
        JH-Toolkit v1.4.0 · Generated by Doxygen
    </div>
    <div class="footer-note">
        We primarily support embedded documentation views in IDEs (classic CLion).
        To ensure compatibility with embedded rendering, some example code in this
        documentation intentionally contains HTML entities.
        In certain cases, Doxygen does not unescape these entities correctly.
        This is a known limitation and currently has no workaround.
    </div>
</div>
</body>
</html>
