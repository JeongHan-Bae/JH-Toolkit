<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JH-Toolkit: include/jh/ranges/collect.h File Reference</title>
<link rel="icon" href="Jindallae.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Oree.svg"/></td>
  <td id="projectalign">
   <div id="projectname">JH-Toolkit<span id="projectnumber">&#160;v1.4.0</span>
   </div>
   <div id="projectbrief">An engineering-oriented C++20 toolkit with duck-typed concepts, static design, async coroutines, and semantic containers — header-only, RTTI-free, and concurrency-friendly.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('collect_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">collect.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Eager materialization adaptor — explicitly terminates a lazy range pipeline and realizes it into a concrete container <code>C</code>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;ranges&gt;</code><br />
<code>#include &quot;<a class="el" href="">jh/conceptual/collectable_container.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/ranges/to.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">jh/metax/adl_apply.h</a>&quot;</code><br />
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:jh_3A_3Aranges_3A_3Acollect_5Ffn_3C_20C_20_3E" id="r_jh_3A_3Aranges_3A_3Acollect_5Ffn_3C_20C_20_3E"><td class="memItemLeft">struct &#160;</td><td class="memItemRight"><a class="el" href="structjh_1_1ranges_1_1collect__fn.html">jh::ranges::collect_fn&lt; C &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function object implementing <code><a class="el" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73" title="Global instance of the collect adaptor.">jh::ranges::collect</a></code>.  <a href="structjh_1_1ranges_1_1collect__fn.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4fa041b6ca91a41909afcbf0251cadfd" id="r_a4fa041b6ca91a41909afcbf0251cadfd"><td class="memTemplParams" colspan="2">template&lt;typename C, std::ranges::range R&gt; </td></tr>
<tr class="memitem:a4fa041b6ca91a41909afcbf0251cadfd template"><td class="memItemLeft">constexpr auto&#160;</td><td class="memItemRight"><a class="el" href="namespacejh_1_1ranges.html#a4fa041b6ca91a41909afcbf0251cadfd">jh::ranges::collect_adaptor</a> (R &amp;&amp;r)</td></tr>
<tr class="memdesc:a4fa041b6ca91a41909afcbf0251cadfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Core implementation for <code><a class="el" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73" title="Global instance of the collect adaptor.">jh::ranges::collect</a></code> adaptor.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae066e3cad87b5bec3c061fc290e8ad73" id="r_ae066e3cad87b5bec3c061fc290e8ad73"><td class="memTemplParams" colspan="2">template&lt;typename C&gt; </td></tr>
<tr class="memitem:ae066e3cad87b5bec3c061fc290e8ad73 template"><td class="memItemLeft">constexpr <a class="el" href="structjh_1_1ranges_1_1collect__fn.html">collect_fn</a>&lt; C &gt;&#160;</td><td class="memItemRight"><a class="el" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73">jh::ranges::collect</a> {}</td></tr>
<tr class="memdesc:ae066e3cad87b5bec3c061fc290e8ad73"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global instance of the <code>collect</code> adaptor.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Eager materialization adaptor — explicitly terminates a lazy range pipeline and realizes it into a concrete container <code>C</code>. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2025 JeongHan-Bae &lt;mastropseudo@gmail.com&gt; <br  />
 Licensed under the Apache License, Version 2.0 (the "License"); <br  />
 you may not use this file except in compliance with the License.<br  />
 You may obtain a copy of the License at<br  />
 <br  />
 <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a><br  />
 <br  />
 Unless required by applicable law or agreed to in writing, software<br  />
 distributed under the License is distributed on an "AS IS" BASIS,<br  />
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br  />
 See the License for the specific language governing permissions and<br  />
 limitations under the License.<br  />
 <br  />
 Full license: <a href="https://github.com/JeongHan-Bae/JH-Toolkit?tab=Apache-2.0-1-ov-file#readme">GitHub</a></dd></dl>
<dl class="section author"><dt>Author</dt><dd>JeongHan-Bae <a href="#" onclick="location.href='mai'+'lto:'+'mas'+'tr'+'ops'+'eu'+'do@'+'gm'+'ail'+'.c'+'om'; return false;">mastr<span class="obfuscator">.nosp@m.</span>opse<span class="obfuscator">.nosp@m.</span>udo@g<span class="obfuscator">.nosp@m.</span>mail<span class="obfuscator">.nosp@m.</span>.com</a></dd></dl>
<p>The <code><a class="el" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73" title="Global instance of the collect adaptor.">jh::ranges::collect</a></code> adaptor provides an <b>explicit</b> and <b>controlled</b> way to materialize a lazy range into a concrete container. It represents the <b>eager half</b> of <code>std::ranges::to</code>: while <code>to</code> performs direct construction of a <em>closable</em> container, <code>collect</code> enforces <b>explicit evaluation</b> of any lazy or proxy-based range and yields a stable, value-semantic container. </p>
<h3>Behavior overview</h3>
<ul>
<li>
If <code>C</code> and <code>R</code> satisfy <code>closable_container_for&lt;C, R&gt;</code>, it delegates directly to <code><a class="el" href="namespacejh_1_1ranges.html#ae5e54c0ba31518c3451ad297dc995d15" title="Core implementation for jh::ranges::to adaptor.">jh::ranges::to_adaptor&lt;C&gt;</a></code>. </li>
<li>
Otherwise, it performs element-wise insertion according to <code>collectable_status</code> deduction, supporting the four canonical insertion forms aligned with the proposed <code>std::ranges::to</code>: <ul>
<li>
<b><code>emplace_back()</code></b> </li>
<li>
<b><code>push_back()</code></b> </li>
<li>
<b><code>emplace()</code></b> </li>
<li>
<b><code>insert()</code></b> </li>
</ul>
These cover virtually all standard and third-party container families. </li>
<li>
If <code>C</code> provides <code>reserve()</code> and <code>R</code> models <code>sized_range</code>, capacity is automatically preallocated. </li>
</ul>
<h3>Tuple unpacking and reconstruction</h3>
<p>When none of the direct or implicit construction paths apply, and the range's element type is <em>tuple-like</em>, <code>collect</code> attempts a fallback reconstruction step: it unpacks the tuple-like element via <code><a class="el" href="namespacejh_1_1meta.html#a5e3294b6489e7e73d1c0b040b9dbbc86" title="ADL-enabled universal apply for tuple-like objects.">jh::meta::adl_apply</a></code> into <code>emplace_back()</code> or <code>emplace()</code> calls. This mechanism is unique to <code>collect</code> — the standard <code>std::ranges::to</code> does not perform such unpacking. </p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> result = input_strings</div>
<div class="line">  | <a class="code hl_variable" href="namespacejh_1_1ranges_1_1views.html#ad8bed1059cdf6c1295582749bd03983c">jh::ranges::views::enumerate</a>()</div>
<div class="line">  | <a class="code hl_variable" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73">jh::ranges::collect&lt;std::vector&lt;std::pair&lt;size_t, std::string&gt;</a>&gt;&gt;()</div>
<div class="line">  | <a class="code hl_variable" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15">jh::ranges::to</a>&lt;std::pmr::unordered_map&lt;size_t, std::string&gt;&gt;(</div>
<div class="line">        0,</div>
<div class="line">        std::hash&lt;size_t&gt;{},</div>
<div class="line">        std::equal_to&lt;size_t&gt;{},</div>
<div class="line">        alloc</div>
<div class="line">    );</div>
<div class="ttc" id="anamespacejh_1_1ranges_1_1views_html_ad8bed1059cdf6c1295582749bd03983c"><div class="ttname"><a href="namespacejh_1_1ranges_1_1views.html#ad8bed1059cdf6c1295582749bd03983c">jh::ranges::views::enumerate</a></div><div class="ttdeci">constexpr detail::enumerate_fn enumerate</div><div class="ttdoc">The user-facing enumerate adaptor.</div><div class="ttdef"><b>Definition</b> enumerate.h:149</div></div>
<div class="ttc" id="anamespacejh_1_1ranges_html_a722e1bdb5632bc636715eb47ed666b15"><div class="ttname"><a href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15">jh::ranges::to</a></div><div class="ttdeci">constexpr to_fn&lt; C &gt; to</div><div class="ttdoc">Global instance of the to adaptor.</div><div class="ttdef"><b>Definition</b> to.h:347</div></div>
<div class="ttc" id="anamespacejh_1_1ranges_html_ae066e3cad87b5bec3c061fc290e8ad73"><div class="ttname"><a href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73">jh::ranges::collect</a></div><div class="ttdeci">constexpr collect_fn&lt; C &gt; collect</div><div class="ttdoc">Global instance of the collect adaptor.</div><div class="ttdef"><b>Definition</b> collect.h:375</div></div>
</div><!-- fragment --><p>Here, <code>enumerate()</code> (implemented via <a class="el" href="classjh_1_1ranges_1_1zip__view.html" title="A C++20-compatible implementation of std::ranges::zip_view.">jh::ranges::zip_view</a> and std::iota) yields a tuple-like proxy (zip_reference_proxy) combining the index and string reference; <code>collect</code> detects that it cannot insert the proxy directly, unpacks it, and reconstructs real <code>std::pair&lt;size_t, std::string&gt;</code> objects. </p>
<h3>Semantic role</h3>
<p><code>collect</code> defines the <b>explicit evaluation boundary</b> within a lazy pipeline — it marks where deferred computations stop and data becomes concrete. This is crucial when interacting with <code>std::views::transform</code> or other lazy adaptors that convert a range into a transient, consumptive stream. By forcing evaluation, <code>collect</code> ensures that the data is materialized and safe from dangling or deferred access. </p>
<ul>
<li>
<b>Explicit materialization:</b> forces evaluation of lazy pipelines. </li>
<li>
<b>Type normalization:</b> resolves proxy and reference wrappers into value objects. </li>
<li>
<b>Tuple fallback:</b> reconstructs unpacked objects when direct construction is not viable. </li>
</ul>
<h3>Argument policy</h3>
<p><code>collect</code> does <b>not</b> accept additional constructor arguments. It performs data normalization only — all container-specific configuration (e.g. allocators, hashers, comparators) belongs to <code><a class="el" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15" title="Global instance of the to adaptor.">jh::ranges::to</a></code>. </p>
<div class="fragment"><div class="line"><span class="comment">// Correct pipeline:</span></div>
<div class="line"><span class="keyword">auto</span> result = lazy_view</div>
<div class="line">  | <a class="code hl_variable" href="namespacejh_1_1ranges.html#ae066e3cad87b5bec3c061fc290e8ad73">jh::ranges::collect&lt;std::vector&lt;Key, Val&gt;</a>&gt;()</div>
<div class="line">  | <a class="code hl_variable" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15">jh::ranges::to</a>&lt;std::pmr::unordered_map&lt;Key, Val&gt;&gt;(</div>
<div class="line">        0,</div>
<div class="line">        std::hash&lt;Key&gt;{},</div>
<div class="line">        std::equal_to&lt;Key&gt;{},</div>
<div class="line">        alloc</div>
<div class="line">    );</div>
</div><!-- fragment --><p>Do <b>not</b> use <code>std::move()</code> between <code>collect</code> and <code>to</code> — it provides no benefit. The two adaptors are designed to compose directly in a pipeline; move construction is handled automatically via RVO/NRVO. See the <code>to</code> adaptor documentation for detailed move semantics. </p>
<h3>Direct completion</h3>
<p>If your target container is a standard type that does not require extra constructor parameters (e.g. <code>std::vector</code>, <code>std::set</code>, <code>std::unordered_map</code>), you can use <code>collect&lt;C&gt;</code> directly as the final stage. Performance will be identical to <code>to</code> because, when possible, <code>collect</code> automatically dispatches to <code>to_adaptor&lt;C&gt;</code> internally. </p>
<h3>Design rationale</h3>
<ul>
<li>
<b>Evaluation control:</b> explicitly terminates lazy or consumptive pipelines. </li>
<li>
<b>Unified insertion model:</b> supports four canonical insertion forms and extends them with tuple-based reconstruction. </li>
<li>
<b>Predictable semantics:</b> forbids extra arguments, ensuring unambiguous materialization. </li>
<li>
<b>Composable design:</b> integrates seamlessly with <code><a class="el" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15" title="Global instance of the to adaptor.">jh::ranges::to</a></code> for final adaptation. </li>
</ul>
<h4>Relation to <code><a class="el" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15" title="Global instance of the to adaptor.">jh::ranges::to</a></code></h4>
<p><code>collect</code> focuses on <b>materialization</b> — forcing a lazy range into stable storage. <code>to</code> focuses on <b>adaptation</b> — constructing the final container, possibly with configuration parameters. </p>
<ol>
<li>
<code>collect&lt;V&gt;()</code> — eagerly realize and normalize data. </li>
<li>
<code>to&lt;C&gt;(...)</code> — adapt and construct the final container. </li>
</ol>
<p>Together they form a deterministic two-phase pipeline, separating lazy evaluation from container adaptation for clarity, safety, and composability. </p>
<dl class="section note"><dt>Note</dt><dd><code>collect</code> is more permissive than <code>to</code>: it accepts any range that supports minimal insertion semantics, and provides additional tuple-unpacking fallback paths. However, because it forbids extra arguments, configuration such as allocators or policies must be handled by <code>to</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="namespacejh_1_1ranges.html#a722e1bdb5632bc636715eb47ed666b15" title="Global instance of the to adaptor.">jh::ranges::to</a> </dd>
<dd>
<a class="el" href="conceptjh_1_1concepts_1_1collectable__container__for.html" title="Concept verifying that a container C can collect elements from a range R via incremental insertion.">jh::concepts::collectable_container_for</a> </dd></dl>
<dl class="section version"><dt>Version</dt><dd><pre>1.3.x</pre> </dd></dl>
<dl class="section date"><dt>Date</dt><dd><pre>2025</pre> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
</div> <!-- top -->
<hr class="footer"/>
<div class="footer">
    <img class="footer-logo" src="Ojing.svg" alt="Ojing"/>
    <div class="footer-text">
        JH-Toolkit v1.4.0 · Generated by Doxygen
    </div>
    <div class="footer-note">
        We primarily support embedded documentation views in IDEs (classic CLion).
        To ensure compatibility with embedded rendering, some example code in this
        documentation intentionally contains HTML entities.
        In certain cases, Doxygen does not unescape these entities correctly.
        This is a known limitation and currently has no workaround.
    </div>
</div>
</body>
</html>
